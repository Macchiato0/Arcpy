# creat a layer of audit area complete-fail
# extract the address from the comment of very entry of field audit
# address=*+digit + two strings after the digit+*
import arcpy

cursor=arcpy.da.SearchCursor("AuditArea selection",["COMMENTS"])
row_list=[row[0] for row in cursor]
cursor=arcpy.da.SearchCursor("AuditArea selection",["OBJECTID"])
row_oid=[row[0] for row in cursor]

# normalize and ignore some confused unicode data
import unicodedata
comment=[unicodedata.normalize('NFKD', i).encode('ascii','ignore') for i in row_list]

# Street Address search in a string of comment
import re

# split every string in cooment into word by word 
comment_split=[re.split("\s", i) for i in comment]

# parse the comment and select the address
# 1. assume that all street address start with a number, excludes the number of street (always in (0,100)) or the meter number (7 digits)
# 2. creat a hashable Audit_id_address_1 dataset with key as audit area id and value as the parsed address
Audit_id_address_1={}
for i in comment_split:
    num1=[int(j) for j in i if j.isdigit() and 100<int(re.findall("\d+", j)[0])<10000]
    st_number=max(num1) if len(num1)>0 else None
    text_number='{}'.format(st_number) if st_number>0 else None
    position=i.index(text_number) if text_number in i else None
    address_list=i[position:position+3] if position else None
    address=' '.join(address_list) if address_list else None
    address1=address.replace(".",'') if address else None
    address2=address1.replace(",",'') if address1 else None
    Audit_id_address_1[row_oid[comment_split.index(i)]]=address2
    
# 3. select parsed Audit_id_address_1 from address table and find the oid of service point
# 4. create a hashable dictionary key as Audit_area oid and value as service point oid. 
Audit_Sp={}
for key in Audit_id_address_1:
    street_string="STREET like '%{}%'".format(Audit_id_address_1[key]) 
    cursor=arcpy.da.SearchCursor("ELECDIST.ServiceAddress",["SERVICEPOINTOBJECTID"],street_string) 
    for row in cursor:  
        Audit_Sp[key]=row[0]

Audit_Sp
{40981: 750566, 40983: 2505130, 40990: 3488338, 40995: 591811, 41003: 2387877, 87048: 2382751, 97289: 3374074, 157786: 759793, 39045: 2154005, 100487: 1811423, 100488: 2109412, 141450: 1165355, 91523: 1863977, 141456: 1711520, 96963: 3635597, 63681: None, 94406: 2096825, 94407: 1697764, 94408: 1691742, 53459: 578355, 73942: 3753363, 73948: 3407273, 73949: 1193901, 74886: 2157830, 73952: 2387145, 78096: 2156387, 108819: 2157579, 108820: 2157579, 6421: 3377857, 98585: 822115, 98590: 1804518, 74889: 2152573, 184641: 3611316, 112962: 795740, 92483: 1726662, 112964: 805962, 112965: 3810046, 112966: 2154275, 92487: 2574937, 112968: 740439, 112969: 2153716, 112970: 1446627, 92491: 1751338, 112972: 2155718, 92493: 2887323, 92494: 2141280, 92495: 3445096, 92496: 1825028, 65921: 790757, 65922: 2401550, 65923: 746551, 65924: 816666, 65925: 816665, 65926: 733195, 65928: 823317, 76169: 2110654, 55691: 2846869, 76172: 1680226, 65935: 746604, 65936: 746607, 65937: 746606, 65938: 746605, 65940: 817275, 65945: 816556, 101444: 1787561, 65946: 732093, 65948: 790755, 86439: 1660600, 86440: 2130886, 86442: 2115965, 101447: 2123723, 86446: 2385859, 86447: 2385860, 70728: 1817480, 100801: 2098228, 59853: 2121981, 92489: 2575397, 74895: 2768931, 94723: 1718613, 162561: 2386592, 60164: 2115306, 145969: 735584, 85127: 2097333, 78405: 2155665, 88652: 2973641, 88654: 2102831, 88655: 1801872, 88656: 2137850, 78419: 2158485, 62081: None, 62082: 1865765, 62085: 1820762, 62086: 1820775, 62087: 2893591, 62088: 2141434, 62089: 1820776, 62090: 2576640, 62091: 1828764, 62095: 2137333, 62096: 2124767, 62097: 2131649, 62098: 2131649, 62099: 1792830, 62100: 1792866, 62101: 1792821, 62105: 2106166, 62135: 2140612, 62136: 1759153, 62137: 1712038, 62138: 2101697, 62139: 1830931, 86721: 2386644, 66242: 2804986, 76483: 2575201, 96964: 3575092, 96966: 1751235, 99521: 3765906, 219855: 4002176, 66257: 746601, 66258: 3002121, 66264: 2526436, 66270: 2526556, 49921: 3513014, 60162: 2122430, 60163: 2098196, 19204: 2525484, 60165: None, 99523: 2124263, 60167: 2119536, 64642: 741740, 85126: 3631451, 39047: 3665722, 64649: 790759, 74890: 801057, 105281: 1725596, 105282: 1726789, 105283: 1793094, 105284: 2123099, 105285: 3796624, 105286: 3796624, 64327: 2401462, 64328: 825447, 64652: 790757, 105290: 1726265, 64333: 825005, 64334: 2402303, 64335: 2402302, 105299: 1222132, 54414: 2291485, 64343: 781406, 64347: 2399692, 75521: 3234084, 64349: 2401458, 64354: 2402491, 64358: 792159, 64359: 860778, 64360: 860779, 64364: 818013, 64366: 784662, 58241: 797974, 99217: 901140, 99218: 2122311, 99219: 3968305, 232340: 4044957, 58261: 800606, 74564: 2155994, 171845: 2833190, 58278: 2485415, 58280: 2152487, 58281: 2152486, 58282: 749668, 58283: 786640, 58284: 786689, 58286: 173563, 58288: 235238, 171848: 2114896, 58290: 870377, 58293: 1523816, 58294: 779267, 171850: 2044287, 93121: 3300373, 93123: 1147716, 154564: 2575535, 93125: 1836467, 62409: None, 72651: 799037, 72652: 805754, 82893: 2218407, 72654: 774353, 72655: 769118, 79698: 793433, 64339: 816306, 97281: 2575088, 97282: 2575440, 87044: 2388142, 87045: 741209, 97288: 1077335, 87049: 2589664, 87053: 2383563, 46095: 1725230, 48643: 798796, 58884: 578395, 64348: 818025, 54729: 185777, 80963: 2151413, 50244: 169861, 50245: 169860, 101446: 1677432, 80967: 1692536, 101448: 1737728, 101449: 2137734, 50253: 163242, 50258: 170493, 105602: 3038226, 105603: 1723908, 105604: 2575561, 64645: 781530, 54406: 730642, 105607: 2132894, 85129: 3908393, 64650: 737677, 85131: 3631451, 74892: 3194088, 105613: 2130373, 64654: 3731084, 54415: 192230, 74896: 2811982, 54418: 3160512, 54419: 171371, 54421: 170710, 54422: 171376, 54423: 2533351, 54425: 2754258, 54426: 166746, 54428: 163623, 54429: 2291664, 105606: 3377908, 79041: 762855, 79043: 2153521, 58565: 766510, 58567: 734941, 58568: 2156674, 48329: 797993, 48334: 2467076, 58576: 842073, 58577: 4067828, 58588: 2099175, 58589: 2389630, 58590: 1746674, 79056: 739675, 72961: 805716, 93443: 2574550, 93444: 3407292, 93445: 2133795, 93448: 2108643, 93449: 2560979, 72970: 736148, 72971: 731225, 72974: 2156873, 72975: 800035, 72981: 2155430, 72989: 768877, 73005: 2156612, 73006: 2156390, 73008: 762167, 73026: 769005, 87363: 3339238, 107844: 1731750, 87367: 2229746, 210249: 1152206, 73034: 793693, 73035: 793691, 73045: 1677093, 73048: 1700072, 56672: 169688, 60801: 2905891, 91522: 1739837, 193923: 1191908, 91524: 3452506, 91527: 1701557, 75202: 3740022, 75205: 754470, 75208: 2154372, 75209: 2248968, 75212: 796551, 75214: 2151015, 75215: 730889, 98894: 1758425, 54402: 1684914, 79362: 805564, 99842: 4068643, 58883: 578396, 48644: 1610941, 58885: 2506786, 58887: 567838, 79369: 3455987, 38415: 3665709, 58903: None, 151065: 2384181, 72965: 2152482, 72968: 735451, 72969: 2612995, 93450: 2575317, 206401: 1832056, 165442: 2527980, 165446: 765108, 165447: 3420063, 73301: 3564237, 165462: 859759, 165463: 734652, 6420: 4068497, 87686: 2232390, 78414: 767702, 50885: 806276, 71367: 1794490, 71368: 3239952, 82892: 1662442, 72653: 768755, 102102: 2575844, 102103: 2101082, 102104: 2115257, 204507: 2637131, 102108: 1863745, 205129: 2120813, 55041: 185387, 55048: 2134209, 55049: 1727388, 55050: 4003955, 113282: 2157730, 55054: 2574695, 51847: 770205, 105287: 1747319, 223042: 3813887, 38725: 796604, 100166: 3080535, 100167: 1743449, 100168: 1057952, 171849: 2101926, 100170: 1700778, 100171: 2114605, 171852: 158398, 59213: 797570, 100175: 769384, 59217: 765622, 171847: 1752530, 79699: 3752123, 59220: 801918, 79702: 2156350, 79705: 802555, 79712: 734733, 72964: 2152716, 76171: 1830478, 64646: 790763, 92486: 2574937, 112967: 2151899, 87369: 2233726, 88004: 3176027, 112973: 2156897, 62412: 2407766}        
        
# 5. check if the Audit_Area and Service Point are at the right location, and move the sp to the added sp location 
 


# 6. check if all the audit_area has a coresponding service point

#
    



